---
// src/components/ViewCounter.astro
interface Props {
  slug: string;
}

const { slug } = Astro.props;

// 定义一个异步函数来获取阅读数
async function getViews() {
  try {
    const res = await fetch(`/api/views?slug=${slug}`);
    if (!res.ok) return 0; // 请求失败返回 0
    const data = await res.json();
    return data.views || 0;
  } catch (error) {
    console.error('Failed to fetch views:', error);
    return 0;
  }
}

// 在服务端渲染时获取阅读数
const views = await getViews();
---

<span class="view-counter" data-slug={slug}>
  {views} 次阅读
</span>

<style>
  .view-counter {
    @apply text-sm text-gray-500 dark:text-gray-400;
  }
</style>
